<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TAXOL - Taxi Online</title>

  <!-- Library untuk menyimpan struk sebagai JPEG -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Segoe UI", "Inter", -apple-system, BlinkMacSystemFont, Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background: linear-gradient(135deg, #f97316 0%, #ea580c 50%, #dc2626 100%);
      min-height: 100vh;
    }

    .hidden {
      display: none !important;
    }

    /* Welcome Screen */
    .welcome-screen {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
    }

    .welcome-card {
      background: white;
      border-radius: 1.5rem;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
      width: 100%;
      max-width: 450px;
      padding: 2rem;
    }

    .logo-container {
      text-align: center;
      margin-bottom: 2rem;
    }

    .logo-icon {
      width: 80px;
      height: 80px;
      background: white;
      border-radius: 1rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    .logo-title {
      font-size: 2.5rem;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 0.5rem;
    }

    .logo-tagline {
      color: #6b7280;
      font-size: 0.875rem;
    }

    .welcome-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #1f2937;
      text-align: center;
      margin-bottom: 1.5rem;
    }

    .btn {
      width: 100%;
      padding: 1rem 1.5rem;
      border: none;
      border-radius: 0.75rem;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .btn-primary {
      background: linear-gradient(135deg, #f97316, #dc2626);
      color: white;
      box-shadow: 0 4px 12px rgba(249, 115, 22, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(249, 115, 22, 0.5);
    }

    .btn-outline {
      background: white;
      color: #f97316;
      border: 2px solid #f97316;
    }

    .btn-outline:hover {
      background: rgba(249, 115, 22, 0.05);
    }

    .btn-secondary {
      background: white;
      color: #1f2937;
      border: 2px solid #e5e7eb;
    }

    .btn-secondary:hover {
      background: #f9fafb;
    }

    .divider {
      display: flex;
      align-items: center;
      margin: 1.5rem 0;
    }

    .divider-line {
      flex: 1;
      height: 1px;
      background: #e5e7eb;
    }

    .divider-text {
      padding: 0 1rem;
      color: #6b7280;
      font-size: 0.875rem;
    }

    .link-text {
      text-align: center;
      margin-top: 1rem;
    }

    .link-text a {
      color: #f97316;
      text-decoration: none;
      font-size: 0.875rem;
      font-weight: 600;
    }

    .link-text a:hover {
      text-decoration: underline;
    }

    .footer-text {
      text-align: center;
      color: rgba(255, 255, 255, 0.9);
      font-size: 0.75rem;
      margin-top: 1.5rem;
    }

    /* Login Screen */
    .login-screen {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
    }

    .input-group {
      margin-bottom: 1rem;
    }

    .input-label {
      display: block;
      font-size: 0.875rem;
      font-weight: 600;
      color: #374151;
      margin-bottom: 0.5rem;
    }

    .input-wrapper {
      position: relative;
    }

    .input-icon {
      position: absolute;
      left: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      color: #9ca3af;
    }

    .input-field {
      width: 100%;
      padding: 0.75rem 1rem 0.75rem 2.5rem;
      border: 2px solid #e5e7eb;
      border-radius: 0.75rem;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .input-field:focus {
      outline: none;
      border-color: #f97316;
      box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1);
    }

    .text-right {
      text-align: right;
    }

    .text-link {
      color: #f97316;
      text-decoration: none;
      font-size: 0.875rem;
      font-weight: 600;
    }

    .text-link:hover {
      text-decoration: underline;
    }

    .btn-group {
      display: flex;
      gap: 0.75rem;
      margin-top: 1rem;
    }

    .btn-group .btn {
      flex: 1;
      margin-bottom: 0;
    }

    /* Register Screen */
    .register-screen {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
    }

    .register-card {
      background: white;
      border-radius: 1.5rem;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
      width: 100%;
      max-width: 700px;
      padding: 2rem;
      max-height: 80vh;
      overflow-y: auto;
    }

    .register-title {
      font-size: 1.875rem;
      font-weight: 700;
      color: #1f2937;
      text-align: center;
      margin-bottom: 0.5rem;
    }

    .register-subtitle {
      text-align: center;
      color: #6b7280;
      margin-bottom: 1.5rem;
      font-size: 0.875rem;
    }

    .service-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.75rem;
      margin-top: 0.5rem;
    }

    .service-btn {
      padding: 0.75rem;
      border: 2px solid #e5e7eb;
      border-radius: 0.75rem;
      background: white;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      font-weight: 600;
    }

    .service-btn:hover {
      border-color: #f97316;
    }

    .service-btn.active {
      border-color: #f97316;
      background: rgba(249, 115, 22, 0.1);
      color: #f97316;
    }

    textarea.input-field {
      resize: none;
      padding: 0.75rem 1rem 0.75rem 2.5rem;
      font-family: inherit;
    }

    .checkbox-group {
      display: flex;
      align-items: start;
      gap: 0.5rem;
      margin: 1rem 0;
    }

    .checkbox-group input[type="checkbox"] {
      width: 1.125rem;
      height: 1.125rem;
      margin-top: 0.25rem;
      cursor: pointer;
      accent-color: #f97316;
    }

    .checkbox-group label {
      font-size: 0.875rem;
      color: #6b7280;
      flex: 1;
    }

    /* Rating Styles */
.rating-container {
  background: #f9fafb;
  border-radius: 0.75rem;
  padding: 1.5rem;
  text-align: center;
}

.star-rating {
  display: flex;
  justify-content: center;
  gap: 0.5rem;
  margin-bottom: 1rem;
}

.star {
  font-size: 2.5rem;
  color: #e5e7eb;
  cursor: pointer;
  transition: all 0.2s ease;
  user-select: none;
}

.star:hover,
.star.active {
  color: #fbbf24;
  transform: scale(1.1);
}

.star.active {
  animation: starPulse 0.3s ease;
}

@keyframes starPulse {
  0%, 100% { transform: scale(1.1); }
  50% { transform: scale(1.3); }
}

.rating-text {
  font-size: 1rem;
  font-weight: 600;
  color: #6b7280;
  transition: all 0.3s ease;
}

.rating-text.rated {
  color: #f97316;
  font-size: 1.125rem;
}

/* Admin Link */
    .admin-link {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: linear-gradient(135deg, #1f2937, #111827);
      color: white;
      padding: 12px 24px;
      border-radius: 50px;
      text-decoration: none;
      font-weight: 600;
      font-size: 0.875rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      z-index: 9999;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .admin-link:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
      background: linear-gradient(135deg, #374151, #1f2937);
    }

    /* Dashboard */
    .dashboard-screen {
      min-height: 100vh;
      background: #f3f4f6;
    }

    .dashboard-header {
      background: linear-gradient(135deg, #f97316, #dc2626);
      color: white;
      padding: 1.5rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .dashboard-header-content {
      max-width: 1280px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .dashboard-title {
      font-size: 1.5rem;
      font-weight: 700;
    }

    .dashboard-subtitle {
      font-size: 0.875rem;
      opacity: 0.9;
      margin-top: 0.25rem;
    }

    .dashboard-content {
      max-width: 1280px;
      margin: 0 auto;
      padding: 1.5rem;
    }

    .tabs {
      display: flex;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }

    .tab-btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 0.75rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.5);
      color: #1f2937;
    }

    .tab-btn.active {
      background: white;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .card {
      background: white;
      border-radius: 1rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .card-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 1rem;
    }

    .terminal-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.75rem;
      margin-top: 0.5rem;
    }

    .terminal-btn {
      padding: 0.75rem;
      border: 2px solid #e5e7eb;
      border-radius: 0.75rem;
      background: white;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
    }

    .terminal-btn:hover {
      border-color: #f97316;
    }

    .terminal-btn.active {
      border-color: #f97316;
      background: rgba(249, 115, 22, 0.1);
      color: #f97316;
    }

    .service-card-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
      margin-top: 0.5rem;
    }

    .service-card {
      padding: 1rem;
      border: 2px solid #e5e7eb;
      border-radius: 0.75rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      background: white;
    }

    .service-card:hover {
      border-color: #f97316;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .service-card.selected {
      border-color: #f97316;
      background: rgba(249, 115, 22, 0.05);
    }

    .service-name {
      font-weight: 700;
      font-size: 1rem;
      color: #1f2937;
      margin-bottom: 0.25rem;
    }

    .service-price {
      font-size: 0.875rem;
      color: #6b7280;
    }

    .voucher-group {
      display: flex;
      gap: 0.5rem;
    }

    .voucher-group .input-field {
      flex: 1;
    }

    .price-box {
      background: #f9fafb;
      border-radius: 0.75rem;
      padding: 1.5rem;
      text-align: center;
      margin: 1rem 0;
    }

    .price-amount {
      font-size: 2rem;
      font-weight: 700;
      color: #1f2937;
    }

    .price-info {
      font-size: 0.875rem;
      color: #6b7280;
      margin-top: 0.5rem;
    }

    .driver-card {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      background: #f9fafb;
      border-radius: 0.75rem;
      margin: 1rem 0;
    }

    .driver-avatar {
      width: 4rem;
      height: 4rem;
      border-radius: 50%;
      background: linear-gradient(135deg, #f97316, #dc2626);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: 700;
      flex-shrink: 0;
    }

    .driver-info {
      flex: 1;
    }

    .driver-name {
      font-weight: 700;
      font-size: 1.125rem;
      color: #1f2937;
    }

    .driver-vehicle {
      color: #6b7280;
      font-size: 0.875rem;
    }

    .driver-rating {
      color: #f97316;
      font-size: 0.875rem;
      margin-top: 0.25rem;
    }

    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
      color: #6b7280;
    }

    .empty-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    .empty-text {
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }

    .empty-subtext {
      font-size: 0.875rem;
      color: #9ca3af;
    }

    .history-item {
      border: 2px solid #e5e7eb;
      border-radius: 0.75rem;
      padding: 1rem;
      margin-bottom: 0.75rem;
      transition: all 0.3s ease;
    }

    .history-item:hover {
      border-color: #f97316;
      background: rgba(249, 115, 22, 0.02);
    }

    .history-customer {
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 0.5rem;
    }

    .history-route {
      font-size: 0.875rem;
      color: #6b7280;
      margin-bottom: 0.25rem;
    }

    .history-details {
      font-size: 0.875rem;
      color: #6b7280;
      margin-bottom: 0.25rem;
    }

    .history-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 0.5rem;
    }

    .history-date {
      font-size: 0.75rem;
      color: #9ca3af;
    }

    .history-price {
      font-weight: 700;
      color: #f97316;
      font-size: 1rem;
    }

    .trip-status {
      text-align: center;
      padding: 2rem;
    }

    .trip-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
    }

    .trip-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 0.5rem;
    }

    .trip-subtitle {
      color: #6b7280;
      margin-bottom: 1.5rem;
    }

    select.input-field {
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236b7280' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 1rem center;
      padding-right: 3rem;
      padding-left: 1rem;
    }

    /* Stats Grid for Driver Dashboard */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .stat-card {
      background: white;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .stat-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .stat-label {
      font-size: 0.875rem;
      color: #6b7280;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: #1f2937;
      margin-top: 0.25rem;
    }

    .stat-icon {
      width: 3rem;
      height: 3rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      font-size: 1.5rem;
    }

    .stat-icon.orange {
      background: rgba(249, 115, 22, 0.1);
    }

    .stat-icon.green {
      background: rgba(34, 197, 94, 0.1);
    }

    .stat-icon.blue {
      background: rgba(59, 130, 246, 0.1);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .terminal-grid,
      .service-card-grid,
      .service-grid {
        grid-template-columns: 1fr;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .dashboard-header-content {
        flex-direction: column;
        gap: 1rem;
      }

      .btn-group {
        flex-direction: column;
      }

      .voucher-group {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>

  <!-- Welcome Screen -->
  <div id="welcomeScreen" class="welcome-screen">
    <div class="welcome-card">
      <div class="logo-container">
        <div class="logo-icon">üöï</div>
        <div class="logo-title">TAXOL</div>
        <div class="logo-tagline">Perjalanan Nyaman, Harga Terjangkau</div>
      </div>

      <h2 class="welcome-title">Selamat Datang</h2>

      <button class="btn btn-primary" onclick="showCustomerDashboard()">
        <span>üë§</span>
        <div style="text-align: left;">
          <div style="font-weight: 700;">Pesan Taksi</div>
          <div style="font-size: 0.875rem; opacity: 0.9;">Sebagai Customer</div>
        </div>
      </button>

      <div class="divider">
        <div class="divider-line"></div>
        <span class="divider-text">ATAU</span>
        <div class="divider-line"></div>
      </div>

      <button class="btn btn-outline" onclick="showDriverLogin()">
        <span>üöó</span>
        <div style="text-align: left;">
          <div style="font-weight: 700;">Masuk Driver</div>
          <div style="font-size: 0.875rem;">Untuk Mitra Driver</div>
        </div>
      </button>

      <div class="link-text">
        <a href="#" onclick="showRegister(); return false;">Belum terdaftar? Daftar sebagai Driver</a>
      </div>

      <div class="footer-text">
        Dengan menggunakan layanan kami, Anda menyetujui Syarat & Ketentuan
      </div>
    </div>
  </div>

  <!-- Driver Login Screen -->
  <div id="loginScreen" class="login-screen hidden">
    <div class="welcome-card">
      <div class="logo-container">
        <div class="logo-icon">üöï</div>
        <div class="logo-title">TAXOL</div>
        <div class="logo-tagline">Portal Mitra Driver</div>
      </div>

      <h2 class="welcome-title">Login Driver</h2>

      <div class="input-group">
        <label class="input-label">Nomor Telepon</label>
        <div class="input-wrapper">
          <span class="input-icon">üì±</span>
          <input type="tel" id="phoneDriver" class="input-field" placeholder="08xxxxxxxxxx">
        </div>
      </div>


      <div class="input-group">
        <label class="input-label">Password</label>
        <div class="input-wrapper">
          <span class="input-icon">üîí</span>
          <input type="password" id="passwordDriver" class="input-field" placeholder="Masukkan password">
        </div>
      </div>

      <div class="text-right" style="margin-bottom: 1rem;">
        <a href="#" class="text-link">Lupa Password?</a>
      </div>

      <button class="btn btn-primary" onclick="handleDriverLogin()">Masuk</button>

      <div class="btn-group">
        <button class="btn btn-secondary" onclick="showWelcome()">Kembali</button>
        <button class="btn btn-outline" onclick="showRegister()">Daftar Driver</button>
      </div>
    </div>
  </div>

  <!-- Register Screen -->
  <div id="registerScreen" class="register-screen hidden">
    <div class="register-card">
      <h1 class="register-title">Daftar Mitra Driver</h1>
      <p class="register-subtitle">Bergabung dan mulai menghasilkan bersama TAXOL</p>

      <div class="input-group">
        <label class="input-label">Nama Lengkap *</label>
        <div class="input-wrapper">
          <span class="input-icon">üë§</span>
          <input type="text" id="fullName" class="input-field" placeholder="Masukkan nama lengkap">
        </div>
      </div>

      <div class="input-group">
        <label class="input-label">Email *</label>
        <div class="input-wrapper">
          <span class="input-icon">üìß</span>
          <input type="email" id="email" class="input-field" placeholder="email@example.com">
        </div>
      </div>

      <div class="input-group">
        <label class="input-label">Nomor Telepon *</label>
        <div class="input-wrapper">
          <span class="input-icon">üì±</span>
          <input type="tel" id="phoneRegister" class="input-field" placeholder="08xxxxxxxxxx">
        </div>
      </div>

      <div class="input-group">
        <label class="input-label">Jenis Layanan *</label>
        <div class="service-grid">
          <button class="service-btn active" onclick="selectVehicleType(this, 'Regular')">
            <div>üöó</div>
            <div>Regular</div>
          </button>
          <button class="service-btn" onclick="selectVehicleType(this, 'Premium')">
            <div>üöô</div>
            <div>Premium</div>
          </button>
          <button class="service-btn" onclick="selectVehicleType(this, 'XL')">
            <div>üöê</div>
            <div>XL</div>
          </button>
        </div>
      </div>

      <div class="input-group">
        <label class="input-label">Nomor Plat Kendaraan *</label>
        <div class="input-wrapper">
          <span class="input-icon">üîñ</span>
          <input type="text" id="plateNumber" class="input-field" placeholder="B 1234 XYZ" style="text-transform: uppercase;">
        </div>
      </div>

      <div class="input-group">
        <label class="input-label">Alamat Lengkap *</label>
        <div class="input-wrapper">
          <span class="input-icon" style="top: 1rem; transform: none;">üìç</span>
          <textarea id="address" class="input-field" placeholder="Masukkan alamat lengkap" rows="3"></textarea>
        </div>
      </div>

      <div class="checkbox-group">
        <input type="checkbox" id="terms">
        <label for="terms">Saya menyetujui syarat dan ketentuan mitra driver TAXOL</label>
      </div>

      <div class="btn-group">
        <button class="btn btn-secondary" onclick="showWelcome()">Kembali</button>
        <button id="registerBtn" class="btn btn-primary" type="button" onclick="handleRegister()">
  Daftar Sekarang
</button>
      </div>
    </div>
  </div>

  <!-- Customer Dashboard -->
  <div id="customerDashboard" class="dashboard-screen hidden">
    <div class="dashboard-header">
      <div class="dashboard-header-content">
        <div>
          <div class="dashboard-title">üöï TAXOL</div>
          <div class="dashboard-subtitle">Perjalanan Nyaman, Harga Terjangkau</div>
        </div>
        <button class="btn btn-secondary" style="width: auto; margin: 0;" onclick="showWelcome()">Keluar</button>
      </div>
    </div>

    <div class="dashboard-content">
      <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('booking')">Pesan</button>
        <button class="tab-btn" onclick="switchTab('history')">Riwayat</button>
      </div>

      <!-- Booking Tab -->
      <div id="bookingTab" class="tab-content active">
        <!-- Booking Form -->
        <div id="bookingForm" class="card">
          <h2 class="card-title">Pesan Taksi</h2>

          <div class="input-group">
            <label class="input-label">üë§ Nama Penumpang</label>
            <input type="text" id="customerName" class="input-field" placeholder="Masukkan nama Anda" style="padding-left: 1rem;">
          </div>

          <div class="input-group">
  <label class="input-label">üìû Nomor Telepon</label>
  <input type="tel" id="customerPhone" class="input-field" placeholder="08xxxxxxxxxx" style="padding-left: 1rem;">
</div>

          

          <div class="input-group">
            <label class="input-label">üìç Lokasi Jemput</label>
            <div class="terminal-grid">
              <button class="terminal-btn" onclick="selectPickup(this, 'Terminal 1')">Terminal 1</button>
              <button class="terminal-btn" onclick="selectPickup(this, 'Terminal 2')">Terminal 2</button>
              <button class="terminal-btn" onclick="selectPickup(this, 'Terminal 3')">Terminal 3</button>
            </div>
          </div>

          <div class="input-group">
            <label class="input-label">üéØ Tujuan</label>
            <input type="text" id="destination" class="input-field" placeholder="Masukkan tujuan" style="padding-left: 1rem;">
          </div>

          <div class="input-group">
            <label class="input-label">üöó Pilih Layanan</label>
            <div class="service-card-grid">
              <div class="service-card selected" onclick="selectService(this, 'regular')">
                <div class="service-name">Regular</div>
                <div class="service-price">Rp 3.000/km</div>
              </div>
              <div class="service-card" onclick="selectService(this, 'premium')">
                <div class="service-name">Premium</div>
                <div class="service-price">Rp 5.000/km</div>
              </div>
              <div class="service-card" onclick="selectService(this, 'xl')">
                <div class="service-name">XL</div>
                <div class="service-price">Rp 4.000/km</div>
              </div>
              <div class="service-card" onclick="selectService(this, 'airport')">
                <div class="service-name">Airport</div>
                <div class="service-price">Tarif Flat</div>
              </div>
            </div>
          </div>

          <div class="input-group">
            <label class="input-label">üè∑ Voucher Diskon</label>
            <div class="voucher-group">
              <input type="text" id="voucher" class="input-field" style="padding-left: 1rem;">
              <button class="btn btn-secondary" style="width: auto; margin: 0;" onclick="applyVoucher()">Terapkan</button>
            </div>
          </div>

          <div class="price-box">
            <div class="price-amount" id="priceEstimate">Rp 75.000</div>
            <div class="price-info" id="tripInfo">Jarak: 25 km ‚Ä¢ Waktu: 50 menit</div>
          </div>

          <button class="btn btn-primary" onclick="findDriver()">üîç Cari Driver</button>
        </div>

        <!-- Driver Found -->
        <div id="driverFoundCard" class="card hidden">
          <h2 class="card-title">Driver Ditemukan!</h2>

          <div class="driver-card">
            <div class="driver-avatar">B</div>
            <div class="driver-info">
              <div class="driver-name">Budi Santoso</div>
              <div class="driver-vehicle">Avanza - B 1234 XYZ</div>
              <div class="driver-rating">‚≠ê 4.8 ‚Ä¢ 1.2k perjalanan</div>
            </div>
          </div>

          <div class="price-box">
            <div class="price-amount" id="driverPrice">Rp 75.000</div>
            <div class="price-info" id="driverRoute">Terminal 1 ‚Üí Tujuan</div>
          </div>

          <button class="btn btn-primary" onclick="startTrip()">Driver Tiba - Mulai Perjalanan</button>
          <button class="btn btn-secondary" onclick="cancelTrip()">Batalkan Pesanan</button>
        </div>

        <!-- On Trip -->
        <div id="onTripCard" class="card hidden">
          <div class="trip-status">
            <div class="trip-icon">üöó</div>
            <h2 class="trip-title">Perjalanan Berlangsung</h2>
            <p class="trip-subtitle">Nikmati perjalanan Anda dengan aman</p>

            <div class="price-box">
              <div class="price-info" id="tripDestination">Menuju: Tujuan</div>
              <div class="price-info" id="tripDuration">Estimasi: 50 menit</div>
            </div>

            <button class="btn btn-primary" style="background: linear-gradient(135deg, #22c55e, #16a34a);" onclick="completeTrip()">‚úì Selesaikan Perjalanan</button>
          </div>
        </div>

        <!-- Complete -->
        <div id="completeCard" class="card hidden">
          <div class="trip-status">
            <div class="trip-icon">‚úì</div>
            <h2 class="trip-title">Perjalanan Selesai!</h2>
            <p class="trip-subtitle">Terima kasih telah menggunakan TAXOL</p>
            

            <div class="price-box">
              <div class="price-amount" id="finalPrice">Rp 75.000</div>
              <div class="price-info" id="finalRoute">Terminal 1 ‚Üí Tujuan</div>
              <div class="price-info" id="finalInfo">Jarak: 25 km ‚Ä¢ Waktu: 50 menit</div>
            </div>

            <div class="input-group">
              <label class="input-label">Metode Pembayaran</label>
              <select id="paymentMethod" class="input-field">
                <option>üíµ Tunai</option>
                <option>üí≥ Kartu Debit/Kredit</option>
                <option>üì± E-Wallet (GoPay, OVO, Dana)</option>
                <option>üè¶ Transfer Bank</option>
              </select>
            </div>
<div class="input-group">
  <label class="input-label">‚≠ê Berikan Rating untuk Driver</label>
  <div class="rating-container">
    <div class="star-rating">
      <span class="star" data-rating="1" onclick="setRating(1)">‚òÖ</span>
      <span class="star" data-rating="2" onclick="setRating(2)">‚òÖ</span>
      <span class="star" data-rating="3" onclick="setRating(3)">‚òÖ</span>
      <span class="star" data-rating="4" onclick="setRating(4)">‚òÖ</span>
      <span class="star" data-rating="5" onclick="setRating(5)">‚òÖ</span>
    </div>
    <div class="rating-text" id="ratingText">Pilih rating Anda</div>
  </div>
</div>

<div class="input-group">
  <label class="input-label">üí¨ Ulasan (Opsional)</label>
  <textarea id="reviewText" class="input-field" placeholder="Bagikan pengalaman Anda dengan driver..." rows="3" style="padding-left: 1rem;"></textarea>
</div> 
            
            <button class="btn btn-primary" onclick="printStruk()">üßæ Cetak Struk</button>
            

  <button class="btn btn-secondary" onclick="location.reload()">üîÅ Pesan Lagi</button>
          </div>
        </div>
      </div>

    

      <!-- History Tab -->
      <div id="historyTab" class="tab-content">
        <div class="card">
          <h2 class="card-title">Riwayat Perjalanan</h2>
          <div id="historyList">
            <div class="empty-state">
              <div class="empty-icon">üìã</div>
              <div class="empty-text">Belum ada riwayat perjalanan</div>
              <div class="empty-subtext">Pesan taksi pertama Anda sekarang!</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Driver Dashboard -->
  <div id="driverDashboard" class="dashboard-screen hidden">
    <div class="dashboard-header">
      <div class="dashboard-header-content">
        <div>
  <div class="dashboard-title">üöó <span id="driverNameDisplay">Partner Driver</span></div>
  <div class="dashboard-subtitle"><span id="driverVehicleDisplay">Selamat bekerja!</span></div>
</div>
        <button class="btn btn-secondary" style="width: auto; margin: 0;" onclick="showWelcome()">Keluar</button>
      </div>
    </div>

    <div class="dashboard-content">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-header">
            <div>
              <div class="stat-label">Order Hari Ini</div>
              <div class="stat-value">12</div>
            </div>
            <div class="stat-icon orange">üöó</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <div>
              <div class="stat-label">Pendapatan Hari Ini</div>
              <div class="stat-value">Rp 450K</div>
            </div>
            <div class="stat-icon green">üí∞</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <div>
              <div class="stat-label">Rating</div>
              <div class="stat-value">4.8 ‚≠ê</div>
            </div>
            <div class="stat-icon blue">üë§</div>
          </div>
        </div>
      </div>

      <div class="card">
        <h2 class="card-title">Riwayat Order</h2>
        <div class="history-item">
          <div class="history-customer">üë§ Andi Prasetyo</div>
          <div class="history-route">üìç Terminal 1 ‚Üí üéØ Sudirman</div>
          <div class="history-details">üöó Regular | 12 km | 24 menit</div>
          <div class="history-footer">
            <div class="history-date">üìÖ 14:30 ‚Ä¢ Selesai</div>
            <div class="history-price">Rp 35.000</div>
          </div>
        </div>

        <div class="history-item">
          <div class="history-customer">üë§ Siti Nurhaliza</div>
          <div class="history-route">üìç Kemang ‚Üí üéØ Terminal 2</div>
          <div class="history-details">üöó Premium | 14 km | 28 menit</div>
          <div class="history-footer">
            <div class="history-date">üìÖ 13:15 ‚Ä¢ Selesai</div>
            <div class="history-price">Rp 42.000</div>
          </div>
        </div>

        <div class="history-item">
          <div class="history-customer">üë§ Budi Santoso</div>
          <div class="history-route">üìç Senayan ‚Üí üéØ Terminal 3</div>
          <div class="history-details">üöó XL | 13 km | 26 menit</div>
          <div class="history-footer">
            <div class="history-date">üìÖ 11:45 ‚Ä¢ Selesai</div>
            <div class="history-price">Rp 38.000</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // State Management
    let currentPickup = '';
    let currentDestination = '';
    let currentService = 'regular';
    let currentDiscount = 0;
    let currentDistance = 25;
    let currentTime = 50;
    let currentPrice = 75000;
    let selectedVehicleType = 'Regular';
    let tripHistory = [];
    let loggedInDriver = null;
    let currentRating = 0;
    let currentReview = '';

    // Navigation Functions
    function showWelcome() {
      hideAllScreens();
      document.getElementById('welcomeScreen').classList.remove('hidden');
      resetBookingForm();
    }

    function showDriverLogin() {
      hideAllScreens();
      document.getElementById('loginScreen').classList.remove('hidden');
    }

    function showRegister() {
      hideAllScreens();
      document.getElementById('registerScreen').classList.remove('hidden');
    }

    function showCustomerDashboard() {
      hideAllScreens();
      document.getElementById('customerDashboard').classList.remove('hidden');
      resetBookingForm();
    }

    function showDriverDashboard() {
  hideAllScreens();
  document.getElementById('driverDashboard').classList.remove('hidden');
  
  if (loggedInDriver) {
    document.getElementById('driverNameDisplay').textContent = loggedInDriver.full_name || 'Partner Driver';
    document.getElementById('driverVehicleDisplay').textContent = `${loggedInDriver.vehicle_type} - ${loggedInDriver.plate_number}`;
  }
}

    function hideAllScreens() {
      document.getElementById('welcomeScreen').classList.add('hidden');
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('registerScreen').classList.add('hidden');
      document.getElementById('customerDashboard').classList.add('hidden');
      document.getElementById('driverDashboard').classList.add('hidden');
    }

    // Tab Switching
    function switchTab(tabName) {
      const tabs = document.querySelectorAll('.tab-btn');
      const contents = document.querySelectorAll('.tab-content');
      
      tabs.forEach(tab => tab.classList.remove('active'));
      contents.forEach(content => content.classList.remove('active'));
      
      event.target.classList.add('active');
      document.getElementById(tabName + 'Tab').classList.add('active');
      
      if (tabName === 'history') {
        loadHistory();
      }
    }

    // Driver Login
   async function handleDriverLogin() {
  const res = await fetch("http://127.0.0.1:5000/login_driver", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
     phone: document.getElementById("phoneDriver").value,
      password: document.getElementById("passwordDriver").value
    })
  });
  const result = await res.json();
  if (res.ok) {
    loggedInDriver = result.driver;
    showDriverDashboard();
  } else {
    alert(result.error);
  }
}


    // Driver Registration
    async function handleRegister() {
  const data = {
    full_name: document.getElementById("fullName").value,
    email: document.getElementById("email").value,
    phone: document.getElementById("phoneRegister").value,
    vehicle_type: selectedVehicleType,
    plate_number: document.getElementById("plateNumber").value,
    address: document.getElementById("address").value,
  };
  
  const res = await fetch("http://127.0.0.1:5000/register", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify(data)
  });
  const result = await res.json();
  alert(result.message || result.error);
  if (res.ok) showWelcome();
}


    // Pickup Selection
    function selectPickup(btn, terminal) {
      document.querySelectorAll('.terminal-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentPickup = terminal;
    }

    // Service Selection
    function selectService(card, service) {
      document.querySelectorAll('.service-card').forEach(c => c.classList.remove('selected'));
      card.classList.add('selected');
      currentService = service;
      updatePrice();
    }

    // Voucher Application
    function applyVoucher() {
      const code = document.getElementById('voucher').value.toUpperCase();
      
      if (code === 'DISKON10') {
        currentDiscount = 0.1;
        alert('‚úÖ Diskon 10% berhasil diterapkan!');
      } else if (code === 'DISKON20') {
        currentDiscount = 0.2;
        alert('‚úÖ Diskon 20% berhasil diterapkan!');
      } else if (code === 'HEMAT50') {
        currentDiscount = 'HEMAT50';
        alert('‚úÖ Potongan Rp 50.000 berhasil diterapkan!');
      } else if (code === 'FREERIDE') {
        currentDiscount = 'FREERIDE';
        alert('‚úÖ Gratis! Voucher berhasil diterapkan!');
      } else {
        alert('‚ùå Voucher tidak valid');
        return;
      }
      
      updatePrice();
    }

    // Price Calculation
    function updatePrice() {
      const prices = { regular: 3000, premium: 5000, xl: 4000, airport: 150000 };
      let distance, time, finalPrice;
      
      if (currentService === 'airport') {
        distance = 25;
        time = 45;
        finalPrice = prices.airport;
      } else {
        distance = Math.floor(Math.random() * 25) + 5;
        time = distance * 2;
        finalPrice = distance * prices[currentService];
      }
      
      if (currentDiscount === 0.1) {
        finalPrice -= finalPrice * 0.1;
      } else if (currentDiscount === 0.2) {
        finalPrice -= finalPrice * 0.2;
      } else if (currentDiscount === 'HEMAT50') {
        finalPrice = Math.max(0, finalPrice - 50000);
      } else if (currentDiscount === 'FREERIDE') {
        finalPrice = 0;
      }
      
      currentDistance = distance;
      currentTime = time;
      currentPrice = Math.round(finalPrice);
      
      document.getElementById('priceEstimate').textContent = 'Rp ' + currentPrice.toLocaleString('id-ID');
     document.getElementById('tripInfo').textContent = `Jarak: ${currentDistance} km ‚Ä¢ Waktu: ${currentTime} menit`;

    }

    // Find Driver
    function findDriver() {
      const name = document.getElementById('customerName').value;
      const destination = document.getElementById('destination').value;
      
      if (!name || !currentPickup || !destination) {
        alert('‚ùå Mohon lengkapi nama, lokasi jemput, dan tujuan');
        return;
      }
      
      currentDestination = destination;
      updatePrice();
      
      document.getElementById('bookingForm').classList.add('hidden');
      document.getElementById('driverFoundCard').classList.remove('hidden');
      
      document.getElementById('driverPrice').textContent = 'Rp ' + currentPrice.toLocaleString('id-ID');
      document.getElementById('driverRoute').textContent = currentPickup + ' ‚Üí ' + currentDestination;
      
      alert('‚úÖ Driver ditemukan!');
    }

    // Start Trip
    function startTrip() {
      document.getElementById('driverFoundCard').classList.add('hidden');
      document.getElementById('onTripCard').classList.remove('hidden');
      
      document.getElementById('tripDestination').textContent = 'Menuju: ' + currentDestination;
      document.getElementById('tripDuration').textContent = 'Estimasi: ' + currentTime + ' menit';
      
      alert('‚úÖ Perjalanan dimulai!');
    }

    // Complete Trip
   function completeTrip() {
  document.getElementById('onTripCard').classList.add('hidden');
  document.getElementById('completeCard').classList.remove('hidden');

  document.getElementById('finalPrice').textContent = 'Rp ' + currentPrice.toLocaleString('id-ID');
  document.getElementById('finalRoute').textContent = currentPickup + ' ‚Üí ' + currentDestination;
  document.getElementById('finalInfo').textContent = `Jarak: ${currentDistance} km ‚Ä¢ Waktu: ${currentTime} menit`;

  // Reset rating
  currentRating = 0;
  currentReview = '';
  document.querySelectorAll('.star').forEach(star => star.classList.remove('active'));
  document.getElementById('ratingText').textContent = 'Pilih rating Anda';
  document.getElementById('ratingText').classList.remove('rated');
  document.getElementById('reviewText').value = '';

  alert('‚úÖ Perjalanan selesai! Berikan rating untuk driver Anda.');


  // Simpan ke history lokal
  const trip = {
    id: Date.now(),
    customerName: document.getElementById('customerName').value,
    pickup: currentPickup,
    destination: currentDestination,
    service: currentService,
    distance: currentDistance,
    time: currentTime,
    price: currentPrice,
    payment: document.getElementById('paymentMethod').value,
    date: new Date().toLocaleDateString('id-ID')
  };
  tripHistory.unshift(trip);

  // === Kirim ke backend Flask ===
  fetch("http://127.0.0.1:5000/api/trips", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      customerName: trip.customerName,
      pickup: trip.pickup,
      destination: trip.destination,
      service: trip.service,
      distance: trip.distance,
      duration: trip.time + " menit",
      price: trip.price,
      paymentMethod: trip.payment
    })
  }).then(res => res.json())
    .then(result => {
      if (result.status === "ok") console.log("‚úÖ Trip tersimpan di DB");
      else console.error("‚ùå Gagal simpan trip", result);
    })
    .catch(err => console.error("‚ö†Ô∏è Error kirim trip:", err));

  alert('‚úÖ Perjalanan selesai!');
}


    // Cancel Trip
    function cancelTrip() {
      document.getElementById('driverFoundCard').classList.add('hidden');
      document.getElementById('bookingForm').classList.remove('hidden');
      alert('‚ùå Pesanan dibatalkan');
    }

    function selectVehicleType(el, type) {
  document.querySelectorAll('.service-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
  selectedVehicleType = type; // pakai variabel global kamu
}

    // Back to Booking
    function backToBooking() {
      document.getElementById('completeCard').classList.add('hidden');
      document.getElementById('bookingForm').classList.remove('hidden');
      resetBookingForm();
    }

    // Reset Booking Form
    function resetBookingForm() {
      document.getElementById('customerName').value = '';
      document.getElementById('customerPhone').value = '';
      document.getElementById('destination').value = '';
      document.getElementById('voucher').value = '';
      currentPickup = '';
      currentDiscount = 0;
      currentService = 'regular';
      
      document.querySelectorAll('.terminal-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.service-card').forEach(c => c.classList.remove('selected'));
      document.querySelector('.service-card').classList.add('selected');
      
      updatePrice();
    }

    // Load History
    async function loadHistory() {
  const historyList = document.getElementById('historyList');
  historyList.innerHTML = `<div class="empty-state"><div class="empty-icon">‚è≥</div><div class="empty-text">Memuat riwayat...</div></div>`;

  try {
    const res = await fetch("http://127.0.0.1:5000/api/trips");
    const trips = await res.json();

    if (trips.length === 0) {
      historyList.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">üìã</div>
          <div class="empty-text">Belum ada riwayat perjalanan</div>
          <div class="empty-subtext">Pesan taksi pertama Anda sekarang!</div>
        </div>
      `;
    } else {
      historyList.innerHTML = "";
      trips.forEach(trip => {
        historyList.innerHTML += `
          <div class="history-item">
            <div class="history-customer">üë§ ${trip.customer_name}</div>
            <div class="history-route">üìç ${trip.pickup} ‚Üí üéØ ${trip.destination}</div>
            <div class="history-details">üöó ${trip.service} | ${trip.distance} km | ${trip.duration}</div>
            <div class="history-footer">
              <div class="history-date">üìÖ ${trip.created_at || '-'} ‚Ä¢ ${trip.payment_method}</div>
              <div class="history-price">Rp ${Number(trip.price).toLocaleString('id-ID')}</div>
            </div>
          </div>
        `;
      });
    }
  } catch (err) {
    console.error("‚ö†Ô∏è Gagal memuat riwayat:", err);
    historyList.innerHTML = `
      <div class="empty-state">
        <div class="empty-icon">‚ùå</div>
        <div class="empty-text">Gagal memuat riwayat</div>
        <div class="empty-subtext">Periksa koneksi server TAXOL</div>
      </div>
    `;
  
}

    }

    // Initialize
    updatePrice();

    /* ================================
       CETAK STRUK + SIMPAN JPEG
       ================================ */
    function printStruk() {
  // Validasi rating
  if (currentRating === 0) {
    alert('‚ö†Ô∏è Mohon berikan rating terlebih dahulu!');
    return;
  }

  currentReview = document.getElementById('reviewText').value;

  // Simpan ke history lokal
  const trip = {
    id: Date.now(),
    customerName: document.getElementById('customerName').value,
    pickup: currentPickup,
    destination: currentDestination,
    service: currentService,
    distance: currentDistance,
    time: currentTime,
    price: currentPrice,
    payment: document.getElementById('paymentMethod').value,
    rating: currentRating,
    review: currentReview,
    date: new Date().toLocaleDateString('id-ID')
  };
  tripHistory.unshift(trip);

  // === Kirim ke backend Flask ===
  fetch("http://127.0.0.1:5000/api/trips", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      customerName: trip.customerName,
      pickup: trip.pickup,
      destination: trip.destination,
      service: trip.service,
      distance: trip.distance,
      duration: trip.time + " menit",
      price: trip.price,
      paymentMethod: trip.payment
    })
  }).then(res => res.json())
    .then(result => {
      if (result.status === "ok") console.log("‚úÖ Trip tersimpan di DB");
      else console.error("‚ùå Gagal simpan trip", result);
    })
    .catch(err => console.error("‚ö†Ô∏è Error kirim trip:", err));

  const name = document.getElementById('customerName').value || 'Nama Penumpang';
      const phone = document.getElementById('customerPhone').value || '-';
      const pickup = currentPickup || 'Lokasi Jemput';
      const destination = currentDestination || 'Tujuan';
      const price = document.getElementById('finalPrice').innerText || 'Rp -';
      const payment = document.getElementById('paymentMethod').value || '-';
      const date = new Date().toLocaleString('id-ID');
      const trxId = 'TXL-' + new Date().toISOString().slice(0,10).replace(/-/g,'') + '-' + Math.floor(Math.random()*9000+1000);
const ratingStars = '‚≠ê'.repeat(currentRating);
const reviewSection = currentReview ? `
  <div style="background: #fff5ed; padding: 12px; border-radius: 8px; margin-top: 12px; border-left: 4px solid #f97316;">
    <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px; font-weight: 600;">üí¨ Ulasan Pelanggan:</div>
    <div style="font-size: 13px; color: #374151; font-style: italic;">"${currentReview}"</div>
  </div>
` : '';


      const strukHTML = `
        <div id="strukContainer" style="font-family: Arial, sans-serif; width:380px; margin:auto; padding:18px; border-radius:8px; background:#fff; border:1px solid #eee;">
          <h3 style="text-align:center; margin-bottom:6px; color:#f97316;">üßæ STRUK TAXOL</h3>
          <p style="text-align:center; font-size:12px; margin-bottom:10px; color:#6b7280;">
            Jl. Raya Bandara No. 123, Tangerang<br>
            Telp: 021-555-1234
          </p>
          <hr style="border:none; border-top:1px dashed #eee; margin:8px 0;">
          <table style="width:100%; font-size:13px; border-collapse:collapse;">
            <tr><td style="padding:6px 0; width:40%;">No. Transaksi</td><td style="padding:6px 0;">: ${trxId}</td></tr>
            <tr><td style="padding:6px 0;">Tanggal</td><td style="padding:6px 0;">: ${date}</td></tr>
            <tr><td style="padding:6px 0;">Nama</td><td style="padding:6px 0;">: ${name}</td></tr>
            <tr><td style="padding:6px 0;">Telepon</td><td style="padding:6px 0;">: ${phone}</td></tr>
            <tr><td style="padding:6px 0;">Jemput</td><td style="padding:6px 0;">: ${pickup}</td></tr>
            <tr><td style="padding:6px 0;">Tujuan</td><td style="padding:6px 0;">: ${destination}</td></tr>
            <tr><td style="padding:6px 0;">Metode</td><td style="padding:6px 0;">: ${payment}</td></tr>
            <tr><td style="padding:6px 0;">Rating</td><td style="padding:6px 0;">: ${ratingStars} (${currentRating}/5)</td></tr>
          </table>
          ${reviewSection}
          <hr style="border:none; border-top:1px dashed #eee; margin:8px 0;">
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <div style="font-size:12px; color:#6b7280;">Terima kasih telah menggunakan TAXOL</div>
            <div style="font-weight:700; color:#dc2626; font-size:18px;">${price}</div>
          </div>
          <div style="text-align:center; margin-top:12px;">
            <small style="color:#9ca3af;">Customer Service: 0812-3456-7890</small>
          </div>
        </div>
      `;

      const strukFullHTML = `
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Struk TAXOL - ${trxId}</title>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"><\/script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: linear-gradient(135deg, #f97316 0%, #ea580c 50%, #dc2626 100%);
      font-family: 'Segoe UI', Arial, sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
    }
    .container { max-width: 500px; width: 100%; }
    #strukContainer {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      animation: slideIn 0.5s ease;
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .struk-header { text-align: center; margin-bottom: 20px; }
    .logo-badge {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #f97316, #dc2626);
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      margin-bottom: 12px;
      box-shadow: 0 4px 12px rgba(249, 115, 22, 0.4);
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    .struk-title {
      font-size: 24px;
      font-weight: 700;
      background: linear-gradient(135deg, #f97316, #dc2626);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 6px;
    }
    .company-info { font-size: 12px; color: #6b7280; line-height: 1.5; }
    .divider { border: none; border-top: 2px dashed #e5e7eb; margin: 16px 0; }
    .info-table { width: 100%; font-size: 14px; border-collapse: collapse; }
    .info-table tr { border-bottom: 1px solid #f3f4f6; }
    .info-table td { padding: 10px 4px; }
    .info-label { color: #6b7280; width: 35%; font-weight: 500; }
    .info-value { color: #1f2937; font-weight: 600; }
    .trip-route {
      background: linear-gradient(135deg, rgba(249,115,22,0.1), rgba(220,38,38,0.1));
      padding: 16px;
      border-radius: 12px;
      margin: 16px 0;
      border-left: 4px solid #f97316;
    }
    .route-item {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
      font-size: 14px;
    }
    .route-item:last-child { margin-bottom: 0; }
    .route-icon { font-size: 20px; }
    .route-text { color: #1f2937; font-weight: 600; }
    .price-section {
      background: #f9fafb;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      margin: 16px 0;
    }
    .price-label {
      font-size: 12px;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }
    .price-amount {
      font-size: 32px;
      font-weight: 700;
      color: #dc2626;
      animation: fadeInScale 0.6s ease;
    }
    @keyframes fadeInScale {
      from { opacity: 0; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1); }
    }
    .thank-you {
      text-align: center;
      padding: 16px;
      background: linear-gradient(135deg, rgba(249,115,22,0.05), rgba(220,38,38,0.05));
      border-radius: 12px;
      margin-top: 16px;
    }
    .thank-you-text {
      font-size: 14px;
      color: #374151;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .cs-info { font-size: 12px; color: #6b7280; }
    .btn-group { display: flex; gap: 12px; margin-top: 20px; }
    .btn {
      flex: 1;
      padding: 14px 20px;
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .btn-print {
      background: linear-gradient(135deg, #f97316, #dc2626);
      color: white;
      box-shadow: 0 4px 12px rgba(249, 115, 22, 0.4);
    }
    .btn-print:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(249, 115, 22, 0.5);
    }
    .btn-save {
      background: linear-gradient(135deg, #16a34a, #15803d);
      color: white;
      box-shadow: 0 4px 12px rgba(22, 163, 74, 0.4);
    }
    .btn-save:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(22, 163, 74, 0.5);
    }
    .btn-share {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      color: white;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    }
    .btn-share:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(59, 130, 246, 0.5);
    }
    .status-badge {
      display: inline-block;
      padding: 6px 12px;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: white;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-top: 8px;
    }
    .success-message {
      background: #d1fae5;
      color: #065f46;
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      margin-top: 12px;
      display: none;
      animation: slideIn 0.3s ease;
    }
    @media print {
      body { background: white; padding: 0; }
      .btn-group { display: none; }
      #strukContainer { box-shadow: none; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="strukContainer">
      <div class="struk-header">
        <div class="logo-badge">üöï</div>
        <div class="struk-title">TAXOL</div>
        <div class="company-info">
          Jl. Raya Bandara No. 123, Tangerang<br>
          Telp: 021-555-1234 ‚Ä¢ Email: info@taxol.id
        </div>
        <span class="status-badge">‚úì LUNAS</span>
      </div>
      <div class="divider"></div>
      <table class="info-table">
        <tr><td class="info-label">No. Transaksi</td><td class="info-value">${trxId}</td></tr>
        <tr><td class="info-label">Tanggal & Waktu</td><td class="info-value">${date}</td></tr>
        <tr><td class="info-label">Nama Penumpang</td><td class="info-value">${name}</td></tr>
        <tr><td class="info-label">No. Telepon</td><td class="info-value">${phone}</td></tr>
        <tr><td class="info-label">Jarak Tempuh</td><td class="info-value">${currentDistance} km</td></tr>
        <tr><td class="info-label">Durasi</td><td class="info-value">${currentTime} menit</td></tr>
        <tr><td class="info-label">Metode Bayar</td><td class="info-value">${payment}</td></tr>
      </table>
      <div class="trip-route">
        <div class="route-item">
          <span class="route-icon">üìç</span>
          <div>
            <div style="font-size: 11px; color: #6b7280; text-transform: uppercase;">Penjemputan</div>
            <div class="route-text">${pickup}</div>
          </div>
        </div>
        <div style="text-align: center; margin: 8px 0; color: #9ca3af;">‚Üì</div>
        <div class="route-item">
          <span class="route-icon">üéØ</span>
          <div>
            <div style="font-size: 11px; color: #6b7280; text-transform: uppercase;">Tujuan</div>
            <div class="route-text">${destination}</div>
          </div>
        </div>
      </div>
      <div class="price-section">
        <div class="price-label">Total Pembayaran</div>
        <div class="price-amount">${price}</div>
      </div>
      <div class="divider"></div>
      <div class="thank-you">
        <div class="thank-you-text">‚ú® Terima Kasih Telah Menggunakan TAXOL ‚ú®</div>
        <div class="cs-info">Customer Service 24/7: 0812-3456-7890</div>
      </div>
    </div>
    <div class="btn-group">
      <button class="btn btn-print" onclick="handlePrint()">
        <span>üñ®Ô∏è</span><span>Cetak</span>
      </button>
      <button class="btn btn-save" onclick="handleSave()">
        <span>üíæ</span><span>Simpan</span>
      </button>
      <button class="btn btn-share" onclick="handleShare()">
        <span>üì§</span><span>Bagikan</span>
      </button>
    </div>
    <div class="success-message" id="successMsg">‚úÖ Berhasil!</div>
  </div>
  <script>
    function handlePrint() { window.print(); }
    
    function handleSave() {
  const success = document.getElementById('successMsg');
  const el = document.getElementById('strukContainer');
  const body = document.body;
  const btnGroup = document.querySelector('.btn-group');
  const container = document.querySelector('.container');
  
  // Simpan style original
  const originalBodyBg = body.style.background;
  const originalElShadow = el.style.boxShadow;
  const originalContainerWidth = container.style.width;
  
  // Ubah ke mode capture dengan ukuran lebih besar
  btnGroup.style.display = 'none';
  body.style.background = '#ffffff';
  el.style.boxShadow = 'none';
  container.style.width = '800px'; // Perbesar container untuk hasil lebih tajam
  
  // Ubah semua elemen gradient jadi solid
  const title = document.querySelector('.struk-title');
  const badge = document.querySelector('.logo-badge');
  const statusBadge = document.querySelector('.status-badge');
  const tripRoute = document.querySelector('.trip-route');
  const thankYou = document.querySelector('.thank-you');
  const btns = document.querySelectorAll('.btn');
  
  const originalStyles = {};
  
  if (title) {
    originalStyles.title = title.style.cssText;
    title.style.background = 'none';
    title.style.webkitTextFillColor = '#f97316';
    title.style.color = '#f97316';
    title.style.fontWeight = '700';
  }
  
  if (badge) {
    originalStyles.badge = badge.style.cssText;
    badge.style.background = '#f97316';
    badge.style.animation = 'none';
  }
  
  if (statusBadge) {
    originalStyles.statusBadge = statusBadge.style.cssText;
    statusBadge.style.background = '#22c55e';
  }
  
  if (tripRoute) {
    originalStyles.tripRoute = tripRoute.style.cssText;
    tripRoute.style.background = '#fff5ed';
  }
  
  if (thankYou) {
    originalStyles.thankYou = thankYou.style.cssText;
    thankYou.style.background = '#fff5ed';
  }
  
  btns.forEach(btn => btn.style.display = 'none');
  
  setTimeout(() => {
    html2canvas(el, { 
      scale: 3, // Scale optimal untuk kualitas HD
      useCORS: true,
      allowTaint: true,
      backgroundColor: '#ffffff',
      logging: false,
      windowWidth: 800,
      windowHeight: el.scrollHeight,
      imageTimeout: 0,
      removeContainer: true
    }).then(canvas => {
      // Kembalikan semua style
      body.style.background = originalBodyBg;
      el.style.boxShadow = originalElShadow;
      container.style.width = originalContainerWidth;
      btnGroup.style.display = 'flex';
      
      if (title) title.style.cssText = originalStyles.title;
      if (badge) badge.style.cssText = originalStyles.badge;
      if (statusBadge) statusBadge.style.cssText = originalStyles.statusBadge;
      if (tripRoute) tripRoute.style.cssText = originalStyles.tripRoute;
      if (thankYou) thankYou.style.cssText = originalStyles.thankYou;
      btns.forEach(btn => btn.style.display = '');
      
      const link = document.createElement('a');
      link.download = 'Struk_TAXOL_${trxId}.jpg';
      link.href = canvas.toDataURL('image/jpeg', 0.95);
      link.click();
      
      success.style.display = 'block';
      success.textContent = '√¢≈ì‚Ä¶ Struk HD berhasil disimpan!';
      setTimeout(() => success.style.display = 'none', 3000);
    }).catch(err => {
      console.error('Error:', err);
      // Kembalikan style jika error
      body.style.background = originalBodyBg;
      el.style.boxShadow = originalElShadow;
      container.style.width = originalContainerWidth;
      btnGroup.style.display = 'flex';
      alert('√¢≈í Gagal menyimpan struk');
    });
  }, 500); // Tambah delay untuk render sempurna
}
    function handleShare() {
      const text = \`Perjalanan TAXOL\\n\\nDari: ${pickup}\\nKe: ${destination}\\nTotal: ${price}\\nNo. Transaksi: ${trxId}\`;
      if (navigator.share) {
        navigator.share({ title: 'Struk TAXOL', text: text }).then(() => {
          const success = document.getElementById('successMsg');
          success.style.display = 'block';
          success.textContent = '‚úÖ Berhasil dibagikan!';
          setTimeout(() => success.style.display = 'none', 2000);
        }).catch(() => {});
      } else {
        navigator.clipboard.writeText(text).then(() => {
          const success = document.getElementById('successMsg');
          success.style.display = 'block';
          success.textContent = '‚úÖ Teks disalin ke clipboard!';
          setTimeout(() => success.style.display = 'none', 2000);
        });
      }
    }
  <\/script>
</body>
</html>
`;

const newWin = window.open("", "_blank");
newWin.document.write(strukFullHTML);
newWin.document.close();
    }
    /* ================================
   RATING SYSTEM
   ================================ */
function setRating(rating) {
  currentRating = rating;
  const stars = document.querySelectorAll('.star');
  const ratingText = document.getElementById('ratingText');
  
  stars.forEach((star, index) => {
    if (index < rating) {
      star.classList.add('active');
    } else {
      star.classList.remove('active');
    }
  });
  
  const ratingMessages = {
    1: 'üòû Sangat Tidak Puas',
    2: 'üòï Tidak Puas',
    3: 'üòê Cukup',
    4: 'üòä Puas',
    5: 'ü§© Sangat Puas!'
  };
  
  ratingText.textContent = ratingMessages[rating];
  ratingText.classList.add('rated');
}
  </script>
  <!-- Link ke Admin Panel -->
  <a href="admin.html" class="admin-link">
    üõ°Ô∏è Admin
  </a>

</body>
</html>
